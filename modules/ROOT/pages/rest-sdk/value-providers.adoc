= Define a Value Provider
ifndef::env-site,env-github[]
include::../_attributes.adoc[]
endif::[]

Value providers give the possible values of an operation’s parameter.

Value providers also enable the connector to make a request to an endpoint and get the possible values from there, providing capabilities to extract the actual values from the server response.

== Example: Simple Value Provider

The following example example shows the application of a Value Provider declaration and usage using in the Slack API.

In this example, the `postMessage` method has a value provider implemented:
https://api.slack.com/methods/chat.postMessage

image::channel-parameter.png[]

This endpoint has a required `channel` parameter whose possible values can be obtained by making a request to another endpoint:
https://api.slack.com/methods/conversations.list

image:conversations-list-endpoint.png

A response from this endpoint looks like this:

[source,yaml]
----
{
    "ok": true,
    "channels": [
        {
            "id": "C012AB3CD",
            "name": "general", [..]
        },
        {
            "id": "C061EG9T2",
            "name": "random", [..]
        },
        [..]
    ],
    "response_metadata": {
        "next_cursor": "dGVhbTpDMDYxRkE1UEI="
    }
}
----

Given this, you can create a simple value provider that enables you to provide the possible values for the `channels` parameter.

[source,yaml]
----
valueProviders:
 channels:
   path: /conversations.list
   method: GET
   items:
      extraction:
         expression: “#[payload.channels]”
      displayName:
         expression: “#[item.name]”
      value:
         expression: “#[item.id]”
----

According to the example, the value provider must make a `GET` request to the `/conversations.list` endpoint using the path and method properties respectively.

Next, the provider extracts the array of values from the response with the `extraction` expression, and for each one of these items, `name` property is returned as *displayName*, and the `id` property is returned as *value*.

The user sees *displayName* in the dropdown for the possible channel values, and *value* is sent to the server.

You can then add this value provider to the channel parameter in the operation as shown:

[source,yaml]
----
endpoints:
 /chat.postMessage:
   operations:
     post:
       expects:
         queryParameter:
           channel:
             valueProvider:
               id: channels
----

== Example: Value Provider with Parameters

This example contains the previous parameter provider and adds some intelligence. This value provider uses the operation’s parameters in order to query for the appropriate type of channels.

[source,yaml]
----
valueProviders:
 channels:
   path: /conversations.list
   method: GET
   parameters:
      channelType:
        type: string
   binding:
     queryParams:
       channelType:
         value:
           expression: “#[if(parameters.channelType != null) parameters.channelType else ‘all’]”
   items:
      extraction:
         expression: “#[payload.channels]”
      displayName:
         expression: “#[item.name]”
      value:
         expression: “[item.id]”
----

This value provider resembles the previous one with the exception of the addition of the `binding` node. +
This is a way of forwarding parameters set in the operation to the value provider. These bound parameters can be later used to build the value provider request.

In this example, the `channelType` query parameter is bound to the value provided in the operation `uriChannelType` URI parameter.

[source,yaml]
----
/chat.postMessage/{uriChannelType}:
   operations:
     post:
       expects:
         queryParameter:
           channel:
             valueProvider:
               id: channels
               arguments:
                  channelType:
                    Value: uriParameter.uriChannelType
----

Setting the value provider to the operation is as simple as in the previous example, only that in this case it is validated that the bound parameters exist in the operation before generating the connector code.


== Value Provider Expressions

Depending on the context, the expressions have access to the following variables.

payload:: The full response returned from the server.

attributes:: The response attributes returned from the server. This resembles the attributes from a request done using http connector.

//http connector?

item:: When the response from the server is extracted and split, the _item_ variable contains each of those split values.

parameters:: Contains a map with the parameter names and values sent to this value provider from the operation.

The availability of these variables depending on the expressions is as follows:

[cols=",,,,",options="header",]
|===
| |payload |attributes |item |parameters
a|
Item

Display Name

|Yes |Yes |Yes |-
|Item Value |Yes |Yes |Yes |-
|Item Extraction |Yes |Yes |- |-
|Parameter Binding |- |- |- |Yes
|===
